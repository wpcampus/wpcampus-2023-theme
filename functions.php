<?php

/**
 * Modify theme components.
 * Runs in "wp" action since this is first
 * hook available after WP object is setup
 * and we can use conditional tags.
 */
function wpcampus_2023_setup_theme_parts() {

	// Move notifications on the home page.
	// Print network notifications.
	if ( function_exists( 'wpcampus_print_network_notifications' ) ) {

		if ( is_front_page() ) {
			remove_action( 'wpc_add_before_body', 'wpcampus_print_network_notifications' );
		}
	}

	if ( is_front_page() ) {
		add_action( 'wpcampus_before_article', 'wpcampus_2023_print_site_h1' );
	}
}

add_action( 'wp', 'wpcampus_2023_setup_theme_parts', 10 );

/**
 * Setup/enqueue styles and scripts for theme.
 */
function wpcampus_2023_enqueue_theme() {

	$assets_ver = '1.86';

	// Set the directories.
	$wpcampus_dir = trailingslashit( get_stylesheet_directory_uri() );
	$wpcampus_dir_css = $wpcampus_dir . 'assets/css/';
	$wpcampus_dir_js = $wpcampus_dir . 'assets/js/';

	// Enqueue the base styles and script.
	wp_enqueue_style( 'wpcampus-2023', $wpcampus_dir_css . 'styles.min.css', [ 'wpcampus-parent', 'gform_theme', 'gform_basic', 'gforms_formsmain_css' ], $assets_ver );

	// @TODO move to network?
	wp_enqueue_script( 'wpcampus-2023-nav-focus', $wpcampus_dir_js . 'nav-focus.min.js', [], $assets_ver, true );
	wp_localize_script(
		'wpcampus-2023-nav-focus',
		'wp_nav_focus',
		[
			'expand' => __( 'Expand child menu', 'wpcampus-parent' ),
			'collapse' => __( 'Collapse child menu', 'wpcampus-parent' ),
		]
	);

}

add_action( 'wp_enqueue_scripts', 'wpcampus_2023_enqueue_theme', 10 );

function wpcampus_2023_print_header_menu_item( $menu_item ) {

	$is_current = $_SERVER['REQUEST_URI'] === $menu_item['href'];

	$has_children = ! empty( $menu_item['children'] );

	$li_classes = [ 'nav__item' ];
	$a_classes = [];

	if ( $is_current ) {
		$li_classes[] = 'nav__item--current';
	}

	if ( $has_children ) {
		$li_classes[] = 'nav__item--has-sub';
	}

	if ( ! empty( $li_classes ) ) {
		$li_classes = ' class="' . implode( ' ', $li_classes ) . '"';
	} else {
		$li_classes = '';
	}

	if ( ! empty( $a_classes ) ) {
		$a_classes = ' class="' . implode( ' ', $a_classes ) . '"';
	} else {
		$a_classes = '';
	}

	?>
    <li<?php echo $li_classes; ?>>
        <a<?php echo $a_classes; ?> href="<?php echo $menu_item['href']; ?>"<?php echo ! empty( $menu_item['target'] ) ? ' target="' . $menu_item['target'] . '"' : ''; ?>><span><?php echo $menu_item['text']; ?></span></a>
		<?php

		if ( $has_children ) {
			?>
            <ul class="nav__item__sub">
				<?php

				foreach ( $menu_item['children'] as $child ) {
					wpcampus_2023_print_header_menu_item( $child );
				}

				?>
            </ul>
			<?php
		}

		?>
    </li>
	<?php
}

function wpcampus_2023_print_header() {

	$menu = [
		[
			'href' => '/about/',
			'text' => 'About',
			'children' => [
				[
					'href' => '/about/',
					'text' => 'About the event',
				],
				[
					'href' => '/event-safety-and-responsibility/',
					'text' => 'COVID policies',
				],
				[
					'href' => '/about/organizers',
					'text' => 'Organizers',
				],
				[
					'href' => '/contact',
					'text' => 'Contact us',
				],
			],
		],
		[
			'href' => '/event-safety-and-responsibility/',
			'text' => 'Safety',
		],
		[ 'href' => '/tickets/', 'text' => 'Tickets' ],
		[ 'href' => '/schedule/', 'text' => 'Schedule' ],
		[
			'href' => '/attendees/',
			'text' => 'Attendees',
			'children' => [
				[
					'href' => '/attendees/',
					'text' => 'Information for attendees',
				],
				[
					'href' => '/travel/',
					'text' => 'Travel',
				],
				[
					'href' => '/attendees/lodging/',
					'text' => 'Lodging',
				],
				[
					'href' => 'https://www.google.com/maps/d/u/0/edit?mid=13lSoZjwlnN4AHDDfUxJX4Hk4AWAz3UM&usp=sharing',
					'text' => 'Google map',
					'target' => '_blank',
				],
				[
					'href' => '/volunteers/',
					'text' => 'Volunteers',
				],
			],
		],
		[ 'href' => '/sponsors/', 'text' => 'Sponsors' ],
	];

	?>
    <div class="wpc-container">
        <a class="wpc-2023-logo-link" href="/" title="WPCampus 2023 Home"><?php wpcampus_2023_print_logo(); ?></a>
        <button class="wpc-toggle-menu" data-toggle="wpc-header" aria-label="<?php _e( 'Toggle menu', 'wpcampus-2023' ); ?>">
            <div class="wpc-toggle-bar"></div>
            <div class="wpc-open-menu-label"><?php _e( 'View menu', 'wpcampus-2023' ); ?></div>
        </button>
        <nav class="wpc-2023-nav-primary nav--toggle-sub" aria-label="Primary">
            <ul>
				<?php

				foreach ( $menu as $menu_item ) {
					wpcampus_2023_print_header_menu_item( $menu_item );
				}

				?>
            </ul>
        </nav>
		<?php

		if ( function_exists( 'wpcampus_print_social_media_icons' ) ) {
			wpcampus_print_social_media_icons();
		}

		?>
    </div>
	<?php
}

add_action( 'wpc_add_to_header', 'wpcampus_2023_print_header', 10 );

function wpcampus_2023_print_site_h1() {
	?>
    <h1 class="for-screen-reader">WPCampus: Where WordPress meets higher education</h1>
	<?php
}

function wpcampus_2023_hybrid() {

	$is_tickets = is_page( "tickets" );

	?>
    <div id="wpc-banner-hybrid">
        <p>WPCampus 2023 is a hybrid event.
			<?php
			if ( ! $is_tickets ) :
				?><a href="/tickets/" aria-label="Register for an in-person or online ticket">Join us in-person or online</a><?php
			else:
				?><span>Join us in-person or online.</span><?php
			endif;
			?>
        </p>
    </div>
	<?php
}

add_action( 'wpc_add_after_header', 'wpcampus_2023_hybrid' );

/**
 * Add header action button(s).
 */
function wpcampus_2023_print_hero() {

	if ( ! is_front_page() ) {
		return;
	}

	// @TODO update image description
	$hero_alt = 'A skyline view of downtown New Orleans, Louisiana including a boat on the Mississippi River.';

	?>
    <div id="wpc-home-promo">
        <aside id="wpc-home-hero" aria-label="Photo of New Orleans">
            <div role="img" id="wpc-home-hero-img" aria-label="<?php echo esc_attr( $hero_alt ); ?>"></div>
        </aside>
		<?php

		if ( function_exists( 'wpcampus_print_network_notifications' ) ) {
			wpcampus_print_network_notifications();
		}

		?>
    </div>
	<?php
}

add_action( 'wpc_add_before_body', 'wpcampus_2023_print_hero', 2 );

function wpcampus_2023_print_logo() {
	?>
    <svg class="wpc-2023-logo" aria-label="WPCampus, a hybrid event where WordPress meets higher education, takes place July 12-14, 2023 in New Orleans, Louisiana" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1270 320" xml:space="preserve"><path style="opacity:.7" d="m155 2-31.9 132.8h-16.7l-28.9-103-26.8 103H33.6L0 2h17.2l26.5 107.6L71.9 2h13.5l30.3 107.6L140.4 2zM216.6 134.8H200V2h47c14.7 0 25.5 4 32.5 12S290 31.1 290 41.4c0 11.4-3.8 20.9-11.4 28.3-7.6 7.5-17.6 11.2-29.8 11.2h-32.1v53.9zm0-67.7h30.5c7.8 0 14.1-2.4 18.9-7.1 4.8-4.7 7.2-10.9 7.2-18.6 0-6.6-2.1-12.5-6.4-17.7-4.3-5.2-10.5-7.8-18.5-7.8h-31.6v51.2z"/>
        <path d="m407 84.1 37.2 2.2c-1.7 16.3-7.7 28.8-18 37.5s-22.9 13-37.8 13c-18 0-32.5-6-43.6-17.9-11.1-11.9-16.6-28.4-16.6-49.4 0-20.8 5.2-37.6 15.7-50.4C354.4 6.4 369.1 0 387.8 0c17.5 0 31 4.9 40.4 14.6 9.4 9.7 14.7 22.6 16 38.7l-37.9 2c0-8.9-1.7-15.3-5.1-19.3-3.4-4-7.4-5.9-12-5.9-12.8 0-19.2 12.9-19.2 38.7 0 14.5 1.7 24.3 5 29.5 3.3 5.2 8 7.8 14 7.8 10.7 0 16.7-7.3 18-22zM563 134.8l-7.5-26.2H520l-8 26.2h-33L519.9 2h43l41.6 132.8H563zm-36.1-55.1h21.4l-10.7-38.5-10.7 38.5zM788.8 2v132.8H751V39.9l-24.5 94.9h-25.8l-25.5-94.9v94.9h-30.5V2h53.2l19.2 70.6L735.4 2zM881.9 86.6v48.3h-41.2V2h56.6c14.1 0 24.8 1.6 32.2 4.9 7.3 3.2 13.2 8.2 17.5 14.9 4.3 6.7 6.5 14.2 6.5 22.5 0 12.6-4.4 22.9-13.2 30.6-8.8 7.8-20.5 11.7-35.2 11.7h-23.2zm-.6-28.5h13.6c12 0 18-4.4 18-13.2 0-8.3-5.5-12.5-16.6-12.5h-14.9v25.7zM1107.2 2v88c0 16.7-4.9 28.6-14.8 35.9-9.9 7.3-22.7 10.9-38.6 10.9-16.7 0-30.1-3.5-40.2-10.5-10.1-7-15.2-18.4-15.2-34.2V2h41.3v85.3c0 6.4 1.3 11 4 13.9 2.7 2.9 7 4.4 12.8 4.4 4.9 0 8.9-1.1 12-3.2 3.1-2.1 5-4.5 5.6-7.2.6-2.7.9-7.8.9-15.6V2h32.2zM1151.1 96.4l37.8-6.8c3.2 10.7 11.3 16.1 24.5 16.1 10.2 0 15.3-2.7 15.3-8.2 0-2.9-1.2-5.1-3.5-6.7-2.4-1.6-6.6-3-12.7-4.2-23.2-4.5-38.1-10.3-44.7-17.5-6.6-7.2-9.9-15.7-9.9-25.4 0-12.5 4.7-22.9 14.2-31.2S1195.2 0 1213 0c27 0 44.8 10.9 53.5 32.6l-33.7 10.2c-3.5-8.9-10.6-13.3-21.3-13.3-8.9 0-13.3 2.8-13.3 8.3 0 2.5 1 4.4 3 5.7 2 1.4 5.9 2.7 11.6 3.9 15.9 3.4 27.1 6.3 33.8 8.9 6.7 2.6 12.2 7 16.7 13.3 4.5 6.3 6.7 13.6 6.7 22.1 0 13.4-5.4 24.3-16.3 32.7-10.9 8.3-25.1 12.5-42.8 12.5-32.3 0-52.2-13.5-59.8-40.5zM39 211.6h-4.5l-7.9-26.4c-.4-1.2-.8-2.6-1.3-4.4-.5-1.8-.7-2.9-.7-3.2-.4 2.4-1 5-1.9 7.8L15 211.6h-4.5L0 172.2h4.8l6.2 24.4c.9 3.4 1.5 6.5 1.9 9.3.5-3.3 1.2-6.5 2.2-9.7l7.1-24H27l7.4 24.2c.9 2.8 1.6 5.9 2.2 9.4.3-2.6 1-5.7 1.9-9.3l6.2-24.3h4.8L39 211.6zM86.2 211.6h-4.6V193H60.9v18.6h-4.6v-39.4h4.6v16.7h20.7v-16.7h4.6zM119.5 211.6h-22v-39.4h22v4h-17.4v12.7h16.3v4.1h-16.3v14.5h17.4zM133.3 195.2v16.4h-4.6v-39.5h10.8c4.8 0 8.4.9 10.7 2.8 2.3 1.9 3.5 4.6 3.5 8.4 0 5.2-2.6 8.7-7.9 10.6l10.7 17.7H151l-9.5-16.4h-8.2zm0-3.9h6.3c3.2 0 5.6-.6 7.1-1.9 1.5-1.3 2.3-3.2 2.3-5.8 0-2.6-.8-4.5-2.3-5.6s-4-1.7-7.4-1.7h-5.9v15zM185.3 211.6h-21.9v-39.4h21.9v4h-17.4v12.7h16.4v4.1h-16.4v14.5h17.4zM243.8 211.6h-4.5l-7.9-26.4c-.4-1.2-.8-2.6-1.3-4.4-.5-1.8-.7-2.9-.7-3.2-.4 2.4-1 5-1.9 7.8l-7.7 26.3h-4.5l-10.5-39.5h4.8l6.2 24.4c.9 3.4 1.5 6.5 1.9 9.3.5-3.3 1.2-6.5 2.2-9.7l7.1-24h4.8l7.4 24.2c.9 2.8 1.6 5.9 2.2 9.4.3-2.6 1-5.7 1.9-9.3l6.2-24.3h4.8l-10.5 39.4zM295.2 191.8c0 6.3-1.6 11.3-4.8 14.9-3.2 3.6-7.6 5.4-13.3 5.4-5.8 0-10.3-1.8-13.4-5.3-3.1-3.6-4.7-8.6-4.7-15s1.6-11.4 4.7-14.9c3.2-3.5 7.6-5.3 13.5-5.3 5.7 0 10.1 1.8 13.2 5.4 3.2 3.5 4.8 8.5 4.8 14.8zm-31.3 0c0 5.3 1.1 9.4 3.4 12.2 2.3 2.8 5.6 4.1 9.9 4.1 4.4 0 7.7-1.4 9.9-4.1 2.2-2.8 3.3-6.8 3.3-12.2 0-5.3-1.1-9.3-3.3-12.1-2.2-2.7-5.5-4.1-9.8-4.1-4.4 0-7.7 1.4-9.9 4.1-2.4 2.8-3.5 6.9-3.5 12.1zM309.1 195.2v16.4h-4.6v-39.5h10.8c4.8 0 8.4.9 10.7 2.8 2.3 1.9 3.5 4.6 3.5 8.4 0 5.2-2.6 8.7-7.9 10.6l10.7 17.7h-5.4l-9.5-16.4h-8.3zm0-3.9h6.3c3.2 0 5.6-.6 7.1-1.9 1.5-1.3 2.3-3.2 2.3-5.8 0-2.6-.8-4.5-2.3-5.6s-4-1.7-7.4-1.7h-5.9v15zM370.6 191.5c0 6.5-1.8 11.5-5.3 14.9-3.5 3.4-8.6 5.2-15.2 5.2h-10.9v-39.5h12.1c6.1 0 10.9 1.7 14.3 5.1 3.3 3.5 5 8.2 5 14.3zm-4.8.2c0-5.1-1.3-9-3.9-11.6-2.6-2.6-6.4-3.9-11.5-3.9h-6.6v31.5h5.6c5.5 0 9.6-1.3 12.3-4 2.7-2.8 4.1-6.8 4.1-12zM404.9 183.7c0 4-1.4 7.1-4.1 9.2-2.7 2.1-6.6 3.2-11.7 3.2h-4.6v15.5h-4.6v-39.5h10.2c9.9.1 14.8 3.9 14.8 11.6zm-20.4 8.5h4.1c4.1 0 7-.7 8.8-2 1.8-1.3 2.7-3.4 2.7-6.3 0-2.6-.9-4.6-2.6-5.8-1.7-1.3-4.4-1.9-8-1.9h-5.1v16zM418.3 195.2v16.4h-4.6v-39.5h10.8c4.8 0 8.4.9 10.7 2.8 2.3 1.9 3.5 4.6 3.5 8.4 0 5.2-2.6 8.7-7.9 10.6l10.7 17.7H436l-9.5-16.4h-8.2zm0-3.9h6.3c3.2 0 5.6-.6 7.1-1.9s2.3-3.2 2.3-5.8c0-2.6-.8-4.5-2.3-5.6s-4-1.7-7.4-1.7h-5.9v15zM470.3 211.6h-22v-39.4h22v4h-17.4v12.7h16.3v4.1h-16.3v14.5h17.4zM501.7 201.1c0 3.5-1.3 6.2-3.8 8.1-2.5 1.9-5.9 2.9-10.2 2.9-4.7 0-8.3-.6-10.8-1.8v-4.4c1.6.7 3.4 1.2 5.3 1.6 1.9.4 3.8.6 5.7.6 3.1 0 5.3-.6 6.9-1.7 1.5-1.2 2.3-2.8 2.3-4.8 0-1.4-.3-2.5-.8-3.4-.5-.9-1.5-1.7-2.7-2.4-1.3-.7-3.2-1.6-5.9-2.5-3.7-1.3-6.3-2.9-7.8-4.7-1.6-1.8-2.4-4.1-2.4-7 0-3 1.1-5.5 3.4-7.3 2.3-1.8 5.3-2.7 9-2.7 3.9 0 7.5.7 10.8 2.2l-1.4 4c-3.2-1.4-6.4-2.1-9.5-2.1-2.4 0-4.3.5-5.7 1.6-1.4 1-2 2.5-2 4.3 0 1.4.3 2.5.8 3.4.5.9 1.4 1.7 2.5 2.4 1.2.7 3 1.5 5.5 2.4 4.1 1.5 7 3.1 8.5 4.7 1.6 1.7 2.3 3.9 2.3 6.6zM532.6 201.1c0 3.5-1.3 6.2-3.8 8.1-2.5 1.9-5.9 2.9-10.2 2.9-4.7 0-8.3-.6-10.8-1.8v-4.4c1.6.7 3.4 1.2 5.3 1.6 1.9.4 3.8.6 5.7.6 3.1 0 5.3-.6 6.9-1.7 1.5-1.2 2.3-2.8 2.3-4.8 0-1.4-.3-2.5-.8-3.4-.5-.9-1.5-1.7-2.7-2.4-1.3-.7-3.2-1.6-5.9-2.5-3.7-1.3-6.3-2.9-7.8-4.7-1.6-1.8-2.4-4.1-2.4-7 0-3 1.1-5.5 3.4-7.3 2.3-1.8 5.3-2.7 9-2.7 3.9 0 7.5.7 10.8 2.2l-1.4 4c-3.2-1.4-6.4-2.1-9.5-2.1-2.4 0-4.3.5-5.7 1.6-1.4 1-2 2.5-2 4.3 0 1.4.3 2.5.8 3.4.5.9 1.4 1.7 2.5 2.4 1.2.7 3 1.5 5.5 2.4 4.1 1.5 7 3.1 8.5 4.7 1.5 1.7 2.3 3.9 2.3 6.6zM573.4 211.6l-13.4-35h-.2c.3 2.8.4 6.1.4 9.9v25.1H556v-39.5h6.9l12.5 32.5h.2l12.6-32.5h6.8v39.5h-4.6v-25.4c0-2.9.1-6.1.4-9.5h-.2l-13.5 34.9h-3.7zM628.3 211.6h-21.9v-39.4h21.9v4h-17.4v12.7h16.4v4.1h-16.4v14.5h17.4zM659.5 211.6h-21.9v-39.4h21.9v4h-17.3v12.7h16.3v4.1h-16.3v14.5h17.3zM680.9 211.6h-4.6v-35.4h-12.4v-4h29.5v4h-12.5zM722.1 201.1c0 3.5-1.3 6.2-3.8 8.1-2.5 1.9-5.9 2.9-10.2 2.9-4.7 0-8.3-.6-10.8-1.8v-4.4c1.6.7 3.4 1.2 5.3 1.6 1.9.4 3.8.6 5.7.6 3.1 0 5.3-.6 6.9-1.7 1.5-1.2 2.3-2.8 2.3-4.8 0-1.4-.3-2.5-.8-3.4-.5-.9-1.5-1.7-2.7-2.4-1.3-.7-3.2-1.6-5.9-2.5-3.7-1.3-6.3-2.9-7.8-4.7-1.6-1.8-2.4-4.1-2.4-7 0-3 1.1-5.5 3.4-7.3 2.3-1.8 5.3-2.7 9-2.7 3.9 0 7.5.7 10.8 2.2l-1.4 4c-3.2-1.4-6.4-2.1-9.5-2.1-2.4 0-4.3.5-5.7 1.6-1.4 1-2 2.5-2 4.3 0 1.4.3 2.5.8 3.4.5.9 1.4 1.7 2.5 2.4 1.2.7 3 1.5 5.5 2.4 4.1 1.5 7 3.1 8.5 4.7 1.5 1.7 2.3 3.9 2.3 6.6zM775.4 211.6h-4.6V193h-20.7v18.6h-4.6v-39.4h4.6v16.7h20.7v-16.7h4.6zM786.8 172.2h4.6v39.5h-4.6zM820 190.9h13.4v19.2c-2.1.7-4.2 1.2-6.4 1.5-2.2.3-4.6.5-7.5.5-6 0-10.6-1.8-13.9-5.3-3.3-3.6-5-8.5-5-14.9 0-4.1.8-7.7 2.5-10.8 1.6-3.1 4-5.4 7.1-7.1s6.7-2.4 10.8-2.4c4.2 0 8.1.8 11.7 2.3l-1.8 4c-3.6-1.5-7-2.3-10.3-2.3-4.8 0-8.5 1.4-11.2 4.3-2.7 2.9-4 6.8-4 11.9 0 5.3 1.3 9.4 3.9 12.1 2.6 2.8 6.4 4.1 11.4 4.1 2.7 0 5.4-.3 8-.9V195H820v-4.1zM873.3 211.6h-4.6V193H848v18.6h-4.6v-39.4h4.6v16.7h20.7v-16.7h4.6zM906.6 211.6h-22v-39.4h22v4h-17.4v12.7h16.3v4.1h-16.3v14.5h17.4zM920.4 195.2v16.4h-4.6v-39.5h10.8c4.8 0 8.4.9 10.7 2.8 2.3 1.9 3.5 4.6 3.5 8.4 0 5.2-2.6 8.7-7.9 10.6l10.7 17.7h-5.4l-9.5-16.4h-8.3zm0-3.9h6.3c3.2 0 5.6-.6 7.1-1.9s2.3-3.2 2.3-5.8c0-2.6-.8-4.5-2.3-5.6s-4-1.7-7.4-1.7h-5.9v15zM987.3 211.6h-22v-39.4h22v4h-17.4v12.7h16.3v4.1h-16.3v14.5h17.4zM1028 191.5c0 6.5-1.8 11.5-5.3 14.9-3.5 3.4-8.6 5.2-15.2 5.2h-10.9v-39.5h12.1c6.1 0 10.9 1.7 14.3 5.1 3.3 3.5 5 8.2 5 14.3zm-4.9.2c0-5.1-1.3-9-3.9-11.6-2.6-2.6-6.4-3.9-11.5-3.9h-6.6v31.5h5.6c5.5 0 9.6-1.3 12.3-4 2.8-2.8 4.1-6.8 4.1-12zM1067 172.2v25.5c0 4.5-1.4 8-4.1 10.6-2.7 2.6-6.4 3.9-11.2 3.9-4.7 0-8.4-1.3-11-3.9-2.6-2.6-3.9-6.2-3.9-10.7v-25.4h4.6v25.7c0 3.3.9 5.8 2.7 7.6s4.4 2.6 7.9 2.6c3.3 0 5.9-.9 7.7-2.7s2.7-4.3 2.7-7.6v-25.7h4.6zM1094.9 175.7c-4.3 0-7.7 1.4-10.2 4.3-2.5 2.9-3.8 6.8-3.8 11.9 0 5.2 1.2 9.2 3.6 12 2.4 2.8 5.9 4.2 10.3 4.2 2.7 0 5.9-.5 9.4-1.5v4c-2.7 1-6.1 1.5-10.1 1.5-5.8 0-10.3-1.8-13.4-5.3-3.1-3.5-4.7-8.5-4.7-15 0-4.1.8-7.6 2.3-10.7s3.7-5.4 6.6-7.1c2.9-1.7 6.2-2.5 10.1-2.5 4.1 0 7.7.8 10.8 2.3l-1.9 3.9c-3.1-1.3-6.1-2-9-2zM1138.1 211.6l-4.9-12.5h-15.8l-4.8 12.5h-4.6l15.6-39.6h3.8l15.5 39.6h-4.8zm-6.3-16.7-4.6-12.2c-.6-1.5-1.2-3.4-1.8-5.7-.4 1.7-1 3.6-1.7 5.7l-4.6 12.2h12.7zM1160.9 211.6h-4.6v-35.4h-12.4v-4h29.5v4h-12.5zM1179.8 172.2h4.6v39.5h-4.6zM1229.9 191.8c0 6.3-1.6 11.3-4.8 14.9-3.2 3.6-7.6 5.4-13.3 5.4-5.8 0-10.3-1.8-13.4-5.3-3.2-3.6-4.7-8.6-4.7-15s1.6-11.4 4.7-14.9c3.2-3.5 7.6-5.3 13.5-5.3 5.7 0 10.1 1.8 13.2 5.4s4.8 8.5 4.8 14.8zm-31.3 0c0 5.3 1.1 9.4 3.4 12.2 2.3 2.8 5.6 4.1 9.9 4.1 4.4 0 7.7-1.4 9.9-4.1 2.2-2.8 3.3-6.8 3.3-12.2 0-5.3-1.1-9.3-3.3-12.1-2.2-2.7-5.5-4.1-9.8-4.1-4.4 0-7.7 1.4-9.9 4.1-2.4 2.8-3.5 6.9-3.5 12.1zM1270 211.6h-5.2l-21.5-33.1h-.2c.3 3.9.4 7.4.4 10.7v22.4h-4.2v-39.5h5.2l21.5 33h.2c0-.5-.1-2-.2-4.7-.1-2.6-.2-4.5-.1-5.7v-22.6h4.3v39.5z"/>
        <path style="fill:none" d="M-100.4 859h1431v81h-1431z"/>
        <path d="M6.2 310.8c-2.5 0-4.5-.3-6.2-.7v-6c2.1.4 4 .6 5.5.6 5 0 7.4-2.5 7.4-7.4v-42.4H22V297c0 4.5-1.3 7.9-4 10.3s-6.6 3.5-11.8 3.5zM77.6 254.8v35.7c0 4.1-.9 7.6-2.6 10.7-1.8 3.1-4.3 5.4-7.6 7.1-3.3 1.6-7.3 2.5-11.9 2.5-6.9 0-12.2-1.8-16-5.4-3.8-3.6-5.7-8.6-5.7-15v-35.6h9.1v34.9c0 4.6 1.1 7.9 3.2 10.1 2.1 2.2 5.4 3.2 9.7 3.2 8.5 0 12.8-4.5 12.8-13.4v-34.9h9zM89.7 310v-55.2h9v47.5h23.4v7.7zM143.3 280l13-25.2h9.8l-18.4 33.8V310h-9v-21.1l-18.3-34.1h9.8zM204.7 310h-8.9v-35.7c0-4.3.1-7.6.3-10.1-.6.6-1.3 1.3-2.1 2s-3.7 3-8.5 7l-4.5-5.6 16.2-12.8h7.4V310zM259.2 285.5h19.4v7.6h-19.4zM301.9 310H293v-35.7c0-4.3.1-7.6.3-10.1-.6.6-1.3 1.3-2.1 2s-3.7 3-8.5 7l-4.5-5.6 16.2-12.8h7.4V310zM370.4 301.9c-1.2 4.7-3.4 10.7-6.6 18.1h-6.5c1.7-6.8 3-13.1 3.9-19h8.7l.5.9zM423.3 310h-37.4v-6.7l14.2-14.3c4.2-4.3 7-7.4 8.4-9.2 1.4-1.8 2.4-3.5 3-5.1.6-1.6.9-3.3.9-5.1 0-2.5-.7-4.5-2.2-5.9-1.5-1.4-3.6-2.2-6.2-2.2-2.1 0-4.2.4-6.1 1.2-2 .8-4.3 2.2-6.9 4.2l-4.8-5.9c3.1-2.6 6.1-4.4 9-5.5 2.9-1.1 6-1.6 9.3-1.6 5.1 0 9.3 1.3 12.4 4 3.1 2.7 4.6 6.3 4.6 10.8 0 2.5-.4 4.9-1.3 7.1-.9 2.2-2.3 4.6-4.1 6.9s-4.9 5.6-9.2 9.7l-9.6 9.3v.4h26.2v7.9zM467.4 282.4c0 9.6-1.5 16.7-4.6 21.4-3.1 4.7-7.8 7-14.1 7-6.1 0-10.8-2.4-14-7.2-3.2-4.8-4.8-11.9-4.8-21.2 0-9.7 1.5-16.9 4.6-21.6 3.1-4.6 7.8-6.9 14.1-6.9 6.2 0 10.8 2.4 14 7.3s4.8 11.9 4.8 21.2zm-28.5 0c0 7.5.8 12.9 2.3 16.1 1.5 3.2 4 4.8 7.4 4.8s5.9-1.6 7.5-4.9c1.6-3.3 2.4-8.6 2.4-16.1 0-7.4-.8-12.8-2.4-16.1-1.6-3.3-4.1-5-7.5-5s-5.9 1.6-7.4 4.9c-1.5 3.4-2.3 8.8-2.3 16.3zM511.6 310h-37.4v-6.7l14.2-14.3c4.2-4.3 7-7.4 8.4-9.2 1.4-1.8 2.4-3.5 3-5.1.6-1.6.9-3.3.9-5.1 0-2.5-.7-4.5-2.2-5.9-1.5-1.4-3.6-2.2-6.2-2.2-2.1 0-4.2.4-6.1 1.2-2 .8-4.3 2.2-6.9 4.2l-4.8-5.9c3.1-2.6 6.1-4.4 9-5.5 2.9-1.1 6-1.6 9.3-1.6 5.1 0 9.3 1.3 12.4 4 3.1 2.7 4.6 6.3 4.6 10.8 0 2.5-.4 4.9-1.3 7.1-.9 2.2-2.3 4.6-4.1 6.9-1.9 2.4-4.9 5.6-9.2 9.7l-9.6 9.3v.4h26.2v7.9zM554.1 267.4c0 3.5-1 6.4-3.1 8.8-2 2.3-4.9 3.9-8.6 4.7v.3c4.4.6 7.8 1.9 10 4.1 2.2 2.2 3.3 5.1 3.3 8.8 0 5.3-1.9 9.4-5.6 12.3-3.8 2.9-9.1 4.3-16 4.3-6.1 0-11.3-1-15.5-3v-7.9c2.3 1.2 4.8 2.1 7.5 2.7 2.6.6 5.1.9 7.6.9 4.3 0 7.5-.8 9.6-2.4 2.1-1.6 3.2-4 3.2-7.4 0-3-1.2-5.1-3.5-6.5-2.3-1.4-6-2.1-11-2.1h-5v-7h4.9c8.8 0 13.2-3.1 13.2-9.2 0-2.4-.8-4.2-2.3-5.5-1.5-1.3-3.8-1.9-6.8-1.9-2.1 0-4.1.3-6.1.9-1.9.6-4.2 1.7-6.9 3.5l-4.3-6.2c5.1-3.7 11-5.6 17.7-5.6 5.6 0 9.9 1.2 13 3.6 3.2 2.3 4.7 5.6 4.7 9.8zM251.4 310h-36.9v-6.6l14-14.1c4.1-4.2 6.9-7.3 8.2-9 1.4-1.8 2.3-3.4 3-5 .6-1.6.9-3.2.9-5 0-2.5-.7-4.4-2.2-5.8-1.5-1.4-3.5-2.1-6.1-2.1-2.1 0-4.1.4-6.1 1.2-1.9.8-4.2 2.2-6.8 4.2l-4.7-5.8c3-2.6 6-4.4 8.8-5.4 2.9-1.1 5.9-1.6 9.1-1.6 5.1 0 9.1 1.3 12.2 4s4.6 6.2 4.6 10.7c0 2.5-.4 4.8-1.3 7s-2.2 4.5-4.1 6.8c-1.8 2.3-4.9 5.5-9.1 9.5l-9.5 9.2v.4h25.8v7.4zM353.2 298h-7.4v12h-8.6v-12H312v-6.8l25.2-36.4h8.6v35.9h7.4v7.3zm-16-7.3v-13.8c0-4.9.1-9 .4-12.1h-.3c-.7 1.7-1.8 3.7-3.3 6l-13.7 19.9h16.9zM576.6 281.8c0-3.5.8-6.1 2.5-7.9 1.7-1.8 4-2.7 7.1-2.7 3 0 5.4.9 7.1 2.7 1.7 1.8 2.5 4.5 2.5 7.9 0 3.4-.8 6-2.5 7.9-1.7 1.9-4 2.8-7.1 2.8-3 0-5.4-.9-7.1-2.7-1.6-1.9-2.5-4.6-2.5-8zM664.7 310h-11.1l-27.2-44h-.3l.2 2.5c.4 4.7.5 9 .5 12.8V310h-8.2v-55.2h11l27.1 43.8h.2c-.1-.6-.2-2.7-.3-6.3-.2-3.6-.2-6.5-.2-8.5v-28.9h8.3V310zM709.5 310h-31.2v-55.2h31.2v7.6h-22.2v15.1h20.8v7.5h-20.8v17.4h22.2zM772.4 310h-9.8l-9.4-32.9c-.4-1.4-.9-3.5-1.5-6.2s-1-4.6-1.1-5.6c-.3 1.6-.7 3.7-1.2 6.3-.6 2.6-1 4.5-1.4 5.7l-9.1 32.8H729l-7.1-27.7-7.3-27.6h9.2l7.9 32.2c1.2 5.2 2.1 9.7 2.6 13.7.3-2.1.7-4.5 1.2-7.2.6-2.6 1.1-4.8 1.5-6.4l9-32.3h9l9.2 32.4c.9 3 1.8 7.5 2.8 13.4.4-3.6 1.3-8.2 2.7-13.8l7.9-32.1h9.1L772.4 310zM857.8 282.3c0 9-2.2 16-6.7 21s-10.9 7.5-19.1 7.5c-8.3 0-14.7-2.5-19.2-7.4s-6.7-12-6.7-21.1c0-9.1 2.2-16.1 6.7-21 4.5-4.9 10.9-7.3 19.2-7.3 8.2 0 14.6 2.5 19 7.4 4.5 4.9 6.8 11.9 6.8 20.9zm-42.2 0c0 6.8 1.4 12 4.1 15.5 2.7 3.5 6.8 5.3 12.2 5.3 5.4 0 9.4-1.7 12.1-5.2 2.7-3.5 4.1-8.7 4.1-15.5 0-6.8-1.4-11.9-4.1-15.4-2.7-3.5-6.7-5.3-12.1-5.3-5.4 0-9.5 1.8-12.3 5.3-2.6 3.4-4 8.6-4 15.3zM877.7 288v22h-9v-55.2h15.6c7.1 0 12.4 1.3 15.8 4 3.4 2.7 5.1 6.7 5.1 12.1 0 6.9-3.6 11.8-10.7 14.7l15.6 24.4h-10.3l-13.2-22h-8.9zm0-7.5h6.3c4.2 0 7.3-.8 9.1-2.3 1.9-1.6 2.8-3.9 2.8-7s-1-5.4-3.1-6.7c-2-1.4-5.1-2-9.2-2h-6v18zM918.1 310v-55.2h9v47.5h23.4v7.7zM991.2 310H960v-55.2h31.2v7.6H969v15.1h20.8v7.5H969v17.4h22.2zM1037.4 310l-5.5-15.3h-21.1l-5.4 15.3h-9.5l20.7-55.5h9.8L1047 310h-9.6zm-7.9-23.1-5.2-15c-.4-1-.9-2.6-1.6-4.8-.7-2.2-1.1-3.8-1.4-4.8-.7 3.1-1.7 6.5-3 10.2l-5 14.4h16.2zM1100.3 310h-11.1l-27.2-44h-.3l.2 2.5c.4 4.7.5 9 .5 12.8V310h-8.2v-55.2h11l27.1 43.8h.2c-.1-.6-.2-2.7-.3-6.3-.2-3.6-.2-6.5-.2-8.5v-28.9h8.3V310zM1146.8 295c0 4.9-1.8 8.8-5.3 11.6-3.6 2.8-8.4 4.2-14.7 4.2-6.2 0-11.4-1-15.3-2.9v-8.5c2.5 1.2 5.2 2.1 8 2.8 2.8.7 5.5 1 7.9 1 3.6 0 6.2-.7 7.9-2 1.7-1.4 2.5-3.2 2.5-5.5 0-2.1-.8-3.8-2.3-5.3-1.6-1.4-4.8-3.1-9.7-5.1-5-2-8.6-4.4-10.7-7-2.1-2.6-3.1-5.8-3.1-9.4 0-4.6 1.6-8.2 4.9-10.9 3.3-2.6 7.7-4 13.2-4 5.3 0 10.6 1.2 15.8 3.5l-2.9 7.4c-4.9-2.1-9.3-3.1-13.1-3.1-2.9 0-5.1.6-6.6 1.9-1.5 1.3-2.3 3-2.3 5 0 1.4.3 2.7.9 3.7.6 1 1.6 2 3 2.9 1.4.9 3.9 2.1 7.5 3.6 4.1 1.7 7 3.3 8.9 4.7 1.9 1.5 3.3 3.1 4.2 4.9.8 1.9 1.3 4 1.3 6.5zM1165.7 301.9c-1.2 4.7-3.4 10.7-6.6 18.1h-6.5c1.7-6.8 3-13.1 3.9-19h8.7l.5.9zM1180.2 310v-55.2h9v47.5h23.4v7.7zM1260.4 310l-5.5-15.3h-21.1l-5.4 15.3h-9.5l20.7-55.5h9.8L1270 310h-9.6zm-7.9-23.1-5.2-15c-.4-1-.9-2.6-1.6-4.8-.7-2.2-1.1-3.8-1.4-4.8-.7 3.1-1.7 6.5-3 10.2l-5 14.4h16.2z"/></svg>
	<?php
}

function wpcampus_2023_print_sponsors_grid() {

	if ( ! function_exists( 'wpcampus_sponsors' ) ) {
		return;
	}

	$sponsors = wpcampus_sponsors();

	$sponsors_grid = $sponsors->get_sponsors_grid();

	if ( empty( $sponsors_grid ) ) {
		return;
	}

	$content_before = $sponsors->get_content_before_sponsors_grid();

	?>
    <h2>Our sponsors</h2>
	<?php

	if ( ! empty( $content_before ) ) {
		echo wpautop( $content_before );
	}

	echo $sponsors_grid;

}

function wpcampus_2023_print_sponsors_grid_after_article() {

	$show_sponsors = true;

	if ( is_page( 'sponsors' ) || is_singular( 'sponsor' ) ) {
		$show_sponsors = false;
	}

	if ( is_page( 'tickets/registration' ) || is_page( 'tickets/lodging' ) || is_page( 'tickets/workshops' ) ) {
		$show_sponsors = false;
	}

	if ( is_page( 'event-safety-and-responsibility' ) ) {
		$show_sponsors = false;
	}

	// Only on certain pages.
	/*if ( is_page( 'register' ) ) {
		if ( ! is_user_logged_in() && ( empty( $_GET['format'] ) || $_GET['format'] != 'guest' ) ) {
			$show_sponsors = true;
		}
	} else if ( is_front_page() || is_page( [ 'about', 'register', 'watch' ] ) ) {
		$show_sponsors = true;
	}*/

	if ( ! $show_sponsors ) {
		return;
	}

	?>
    <div class="wpc-sponsors-grid-separator">
		<?php wpcampus_2023_print_sponsors_grid(); ?>
    </div>
	<?php
}

add_action( 'wpcampus_after_article_content', 'wpcampus_2023_print_sponsors_grid_after_article' );